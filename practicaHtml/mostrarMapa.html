<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mi ubicaci贸n en el mapa</title>
  <!-- Bootstrap CSS para dise帽o -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #mapa {
      height: 400px;  /* Altura del mapa */
    }
  </style>
</head>
<body class="bg-light">
<div class="container py-4">
  <h2 class="mb-3 text-primary"> Mostrar ubicaci贸n en el mapa</h2>
  <button class="btn btn-success mb-3" onclick="mostrarUbicacion()">Obtener mi ubicaci贸n</button>
  <div id="info" class="alert alert-info">Haz clic en el bot贸n para obtener tu ubicaci贸n.</div>
  <div id="mapa" class="rounded shadow-sm border"></div>
  <div id="divEmail">
    <label for="divEmail">Email:</label> <input type="email" id="email">
    <input list="ciudades" name="ciudad" id="ciudad">

    <datalist id="ciudades">
      <option value="Quito">
      <option value="Guayaquil">
      <option value="Cuenca">
      <option value="Ambato">
      <option value="Machala">
    </datalist>
  </div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  let mapa; // Variable para almacenar el mapa

  function mostrarUbicacion() {
    const info = document.getElementById("info");

    // Verifica si el navegador soporta geolocalizaci贸n
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
              function(pos) {
                /*
                */
                const lat = obtenerCookie("latitud");
                const lon = obtenerCookie("longitud");
                if (lat==null || lon==null){
                  const lat = pos.coords.latitude;
                  const lon = pos.coords.longitude;
                  alert("Valores tomados de la localizaci贸n actual del usuario");
                }
                info.className = "alert alert-success";
                info.innerHTML = `Tu ubicaci贸n actual es:<br><strong>Latitud:</strong> ${lat}<br><strong>Longitud:</strong> ${lon}`;

                // Inicializa o actualiza el mapa
                if (!mapa) {
                  mapa = L.map('mapa').setView([lat, lon], 15);
                  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; OpenStreetMap contributors'
                  }).addTo(mapa);
                } else {
                  mapa.setView([lat, lon], 15);
                }

                // Agrega un marcador
                L.marker([lat, lon]).addTo(mapa)
                        .bindPopup(" Est谩s aqu铆")
                        .openPopup();
              },
              function(error) {
                info.className = "alert alert-danger";
                info.innerHTML = `Error: ${error.message}`;
              }
      );
    } else {
      info.className = "alert alert-warning";
      info.innerHTML = "Tu navegador no soporta la API de Geolocalizaci贸n.";
    }
  }

  function obtenerCookie(nombre) {
    const nombreEQ = nombre + "=";
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      let c = cookies[i].trim();
      if (c.indexOf(nombreEQ) === 0) {
        return c.substring(nombreEQ.length);
      }
    }
    return null;
  }
</script>
</body>
</html>
